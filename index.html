<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerenciador de Taxas</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        button {
            margin-top: 10px;
        }
        #output {
            white-space: pre-wrap;
            background: #f0f0f0;
            padding: 10px;
            border: 1px solid #ddd;
        }
        .hidden {
            display: none;
        }
        #modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        #modal-content {
            background: #fff;
            padding: 20px;
            border-radius: 5px;
            width: 300px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
        }
        #close {
            float: right;
            font-size: 20px;
            cursor: pointer;
        }
        form label {
            display: block;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <h1>Gerenciador de Taxas</h1>
    <button id="fetch-data">Buscar Dados</button>
    <button id="open-modal">Alterar Taxas</button>

    <pre id="output"></pre>

    <!-- Modal para alterar taxas -->
    <div id="modal" class="hidden">
        <div id="modal-content">
            <span id="close">&times;</span>
            <h2>Alterar Taxas</h2>
            <form id="tax-form">
                <label for="uber-rate">Taxa Uber:</label>
                <input type="number" id="uber-rate" step="0.01" required><br>
                <label for="99-rate">Taxa 99:</label>
                <input type="number" id="99-rate" step="0.01" required><br>
                <button type="submit">Salvar Alterações</button>
            </form>
        </div>
    </div>

    <script>
        const TOKEN = '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';
        const REPO_OWNER = 'Franklinsiltol';
        const REPO_NAME = 'comparatransporte';
        const FILE_PATH = 'taxas.json';
        const BRANCH = 'main';

        const apiUrl = `https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents/${FILE_PATH}`;

        document.getElementById('fetch-data').addEventListener('click', fetchData);
        document.getElementById('open-modal').addEventListener('click', openModal);
        document.getElementById('close').addEventListener('click', closeModal);
        document.getElementById('tax-form').addEventListener('submit', saveChanges);

        function fetchData() {
            fetch(apiUrl, {
                headers: {
                    'Authorization': `token ${TOKEN}`,
                    'Accept': 'application/vnd.github.v3+json'
                }
            })
            .then(response => response.json())
            .then(data => {
                const content = atob(data.content); // Decodifica o conteúdo do arquivo
                document.getElementById('output').textContent = content;
                // Preenche o formulário com os dados atuais
                const json = JSON.parse(content);
                document.getElementById('uber-rate').value = json.uberRate;
                document.getElementById('99-rate').value = json['99Rate'];
            })
            .catch(error => console.error('Erro ao buscar dados:', error));
        }

        function openModal() {
            document.getElementById('modal').classList.remove('hidden');
        }

        function closeModal() {
            document.getElementById('modal').classList.add('hidden');
        }

        function saveChanges(event) {
            event.preventDefault();
            const uberRate = document.getElementById('uber-rate').value;
            const rate99 = document.getElementById('99-rate').value;

            const content = JSON.stringify({ uberRate, 99Rate: rate99 }, null, 2);

            fetch(apiUrl, {
                method: 'GET',
                headers: {
                    'Authorization': `token ${TOKEN}`,
                    'Accept': 'application/vnd.github.v3+json'
                }
            })
            .then(response => response.json())
            .then(data => {
                const sha = data.sha;

                return fetch(apiUrl, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${TOKEN}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: 'Atualizar taxas',
                        content: btoa(content), // Codifica o conteúdo em base64
                        sha: sha,
                        branch: BRANCH
                    })
                });
            })
            .then(response => response.json())
            .then(() => {
                alert('Alterações salvas com sucesso!');
                closeModal();
            })
            .catch(error => console.error('Erro ao salvar alterações:', error));
        }
    </script>
</body>
</html>
